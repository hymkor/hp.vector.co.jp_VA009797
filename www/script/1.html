<HTML>
<HEAD><TITLE>The HAYAMA Script Part-II</TITLE></HEAD>
<BODY	bgcolor="#000000" text="#FFFFFF" link="#00FF00" vlink="#00AA00"
	alink = "#FF0000">

<H3><A NAME="signofeff"><FONT COLOR="#00FFFF"><I
>Sign of Eff</I></FONT></A> (7/26)</H3>

実は先週から NYAOS の一行入力ルーチン（本当はクラスだがルーチンの方が<!--
-->言い易いのでルーチンと呼ぶ）の一般ライブラリ化をやっとりました。
元々、そういう風に作ろうとしていたものなんですが、最初の設計が悪くて、<!--
-->結局転用不能に終ったものを、スクラッチから作り直しているわけです。
今度の奴は簡単に
<PRE>
	CannaInput input;
	char *line=input.getline();
</PRE>
と書けば line に入力した一行が入ります。ヒストリについても、
オブジェクト(CannaInput型変数)ごとに記憶されています。
Vz/bash互換ヒストリ、ファイル名補完などはまだ出来てませんが、
tcsh型ヒストリ、かんなは対応済みです。
将来的には、REXX から使えるようにしたいですね。
完成したら公開しますので、おたのしみに。
<P>
さて、これは何の為にやっているかというと、eff の為つーたら嘘くさいかな？
その eff ですけど、ようやく重い腰を上げて作り始めました。
現在のところ、ただの
<P ALIGN=CENTER>
  <FONT COLOR="#FFFF00" SIZE=+1>カレントディレクトリビューア</FONT>
</P>
みたいなものしか出来とりません。画面イメージは ell より、<!--
-->むしろ emacs に近くなるでしょう。基本的に全画面占有型で、<!--
-->1ファイルを1行で扱います。

ell みたいに画面を必要最小限だけ使うというのは結構手間が<!--
-->かかるので止めました。
その代わり、画面を縦にｎ分割して、
ｎ個のディレクトリを同時に画面に表示できるようにするつもりです。
<P>
しかし、まだ出来ていないものを、こんな風に発表するなんで、
<P ALIGN=CENTER>
	<FONT COLOR="#FF00FF" SIZE=+1>まるでマイワ口ンフトみたいだ。</FONT>
	<BR><SMALL>（ 一応伏せ字にしました;-) ）</SMALL>
</P>
そういうわけで、Wind○ws95/98 のごとく、発表から<STRIKE>発売</STRIKE>公開まで、
かなり期間が空くと覚悟しておいた方がよいでしょう。
そいで、ベータ版やサービスパックをどんどこ公開してしまうという…
<P ALIGN=CENTER>
	<FONT COLOR="#FFFF00" SIZE=+1>やぁ、これは邪悪だ</FONT>
</P>
塩沢兼人さんの声で、お願いします。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
ベルセルクの単行本 10,12,13,15巻がどこにも置いてないよ〜ん。
深夜の放送が終わって以来、急にどこの本屋からも姿を消してやがんの。
何とか見付けたところでも、3,11,14と中途半端な巻しか置いていない。
いい加減、注文した方が早いかなぁ…
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
先週の「あの DOS へ向って撃て」ですけど、
対象として当然ながら WIN-OS/2 も含んでいます。
まぁ、Windows 3.1 は基本的に DOS Extender なんで、
DOS といえば含まれるもんだと思っていたもんで…
それと、あといくつか補足すべきことがあったような気がするんですが、
<P ALIGN=CENTER>
	<FONT SIZE=+1 COLOR="#FF00FF">鳥頭なもんで、忘れてしまった…</FONT>
</P>
いや、ほんとマジで。どうも、若いうちからプログラムを組んでいると、
<P ALIGN=CENTER>
<FONT COLOR="#FFFF00">
	一度に念頭に置かねばならない事が少なくて済むように<BR>
	コーディングした方がよい<BR>
</FONT>		↓<BR>
<FONT COLOR="#FFEE22">
	本質的なことさえ覚えればよいのだ！<BR>
</FONT>		↓<BR>
<FONT COLOR="#FFC044">
	本質的な事以外を覚えようという努力をしなくなる<BR>
</FONT>		↓<BR>
<FONT COLOR="#FF8080">
	本質的な事以外覚えられなくなる<BR>
</FONT>		↓<BR>
<FONT COLOR="#FF40C0">
	本質的な事さえ覚えられなくなる(笑)<BR>
</FONT>		↓<BR>
<FONT COLOR="#FF00FF">
	さらに何をやっても印象に残らなくなる(やばい)<BR>
</FONT>		↓<BR>
<FONT COLOR="#FF0000" SIZE=+1>
	あれ？ 今、何を考えていたんだっけ…(末期症状)<BR>
</FONT>
</P>
こうして痴呆青年が生まれたのであった。困ったもんですねぇ。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
尋ね人：最寄り(多分大阪市内)のナショナル=パナソニックのお店に、<!--
-->「山地 治」という名前の見習従業員を見付けた方は、<!--
--><A HREF="mailto:kaoru@karl.tis.co.jp">その場所を御一報</A>ください
（本人が必死になって秘密にすることって、暴きたくなるもんですよね:-）。

<HR>

<H3><A NAME="dos"
    ><FONT COLOR="#00FFFF"><I>あのＤＯＳへ向って撃て！</I></FONT>(7/18)</H3>

いやぁ、今週は結構メイルいただきました。以前は週に一通いただいたら、
大喜びだったのが、今週は ５,６通はいただいたでしょうか。う〜れしぃなぁ〜。
ページにカウンタ付けてないから分からないんですけど、結構、
<A HREF="http://www.jks.is.tsukuba.ac.jp/~uno/diary/">宇野さんの<!--
-->ページのツッコミ</A>から、こちらへ来る人が多いのかな？
<A HREF="http://www.netpassport.or.jp/~wyuichiy/">山下さん</A>にも<!--
-->リンクを張っていただいたし。
<P>
みなさん、キーボードには僕と同様のこだわりをお持ちのようで、
結構、御自分のキーボードについての意見を添えられていました。
Ctrl キーは Shift キーの下に欲しいと述べた事については、
MyKBD を使ってはどうかという意見もいただきましたし、
やはり自分は「A」の左の方がいいなとおっしゃる方もいました。
こういう話って燃えますねぇ。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
現在、OS/2 ユーザは DOS を必要としているんでしょうか？
かつて、DOSユーザに NativeDOS より優れた DOS として受け入れられた VDM。
しかし、VDM の最大の欠点は longname が見れないということなんですよね。
それゆえ、最近は emx系UNIXソフトに頼って、OS/2 ネイティブの世界へ
みなさん移行してきてられます。
<P>
しかし、なんとか DOS で longname さえ見れたら、DOS の資産も活きてくる
というものです。実は今週、松村 興さんとそれに関してメイルでおしゃべり<!--
-->しました(おしゃべりっていうわけでもないか...)。
松村さんの許可をいただけたので、ちょっと引用し…、あ、
メイルのコピーが入ったフロッピー壊れとるやんけ。
<P>
ということで、簡単に要約すると、最初は VDM にファイルアクセスを供給する
VFAT.SYS (FAT.SYSのVDM版ですよ、注意)を解析、改造すれば、
VDM から長いファイル名を読めるではないかという話だったんです。

でも、これは日本のOS/2人口では難しい(ハッカー率は人口に比例!?)。
VFAT.IFS(95のVFAT用IFSですよ、ややこし)を作ったり、
ハッキーなことをするのはみんな米国人だし、
これでは DBCS対応はあてにならない。
<P>
それより、95フリーウェアのVFATアダプタみたいに、
DOS側にopen/findfirst システムコールを横取りさせる
デバイスドライバ(常駐プログラム!?)を作り、
OS/2側のプロセスと通信させて、Longname⇔Shortname変換させた方が
いいのではないかという感じで話は進みました。
<P>
まぁ、だから俺がやるなどとは申しませんが、せっかくのアイデアを
埋もれさせるのはもったいないし、ということで、どなたかやりませんか？
やるまでとはいかないでも、何か意見がありましたら、お待ちしております
(何を!?)
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
この文書にも時折登場する松下さんちの山地(やまじ)君ですが、
最近、この文書を引用して僕をイヂめます
(飲みに行ってそんなに悪いかぁー)。
だからイヂめ返してあげます(100倍返し!?)。
<P>
まぁ、冗談はともかく、この人、
<A HREF="http://www-lab25.kuee.kyoto-u.ac.jp/member/yamaji/"
>whypic</A> なる画期的な画像圧縮ソフトの開発者です。
この whypic。その特徴は、圧縮率が PI形式をも上回り、
可逆圧縮としては世界一なのです(多分)。
そして、もう一つの特徴。それはモノスゴクオソイこと。
普通のソフトは、その速度はビット数に比例しますけど、whypic は色数に
比例するそうです。つまり、16色はまぁ耐えられる。256色…お、おそい。
65535色…人類が滅ぶ速度だそうです(誰もそんなことは言っていない)。
彼はこのフォーマットへのコンバーターと、Susie へのプラグインだけを作り、
ベクターに投稿したそうなんですが…
<P ALIGN=CENTER>
	<FONT COLOR="#FF00FF" SIZE=+1>(ハンカチの端をくわえながら)<BR>
	きぃぃぃぃぃぃ、くやしぃ<BR>
	<BR>NYAOSよりダウンロード数多いやんけ！</FONT>
</P>
これだから Windows は...(彼は本当は FreeBSD user なんですけどね)。
くやしいので、マルチメディア機能を使って、OS/2 へ移植してやろうと
企んでいるのですが、陰謀にも時間が必要。
やりたいことはいっぱいあるのに、ゆっくりと時間がとれない。トホホ。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
さて、近況。実は前まで仕事でデータベース関係をやることになっていたのですが、
発注が延期になり、仕事が無くなってしまったので、忙しい部署へ<STRIKE>出稼ぎ
</STRIKE>お手伝いに行かされてしまいました(行くっていっても隣だけど)。
そちらの方が扱っていることは、JavaIDL/CORBA などの
分散オブジェクト環境！？ 難しくてついていけないよぉぉぉぉ。
ホント、胃が痛くなった一週間でした。僕は今まで
「難しいことを聞くと頭が痛くなる」というのは、
単なるものの例えだと思っていました。が、
<P ALIGN=CENTER>
	<FONT COLOR="#FF00FF" SIZE=+1>本当に痛くなるもんなんですねぇ</FONT>
</P>
まぁ、半分はカフェインのとりすぎとプレッシャーによるもんなんでしょうが…。
そういうわけで、この連休は勉強です。トホホ。

<HR>

<H3><A NAME="keyboard"
    ><I><FONT COLOR="#00FFFF">キーボートを語る!?</FONT>(7/12)</I></H3>

今週もまた体調よろしく無い一週間でした。
しかし、凝りずに木曜日には人事部の人と江坂で、
金曜日はまたも京都に大学の友達と飲みに行ってしまいました。
だからと言って
<P ALIGN=CENTER>
  <FONT COLOR="#FF00FF" SIZE=+1
  >別に職場でトラブルを起こした訳ではない</FONT>
</P>
ので誤解せぬように。ただ、単に
<P ALIGN=CENTER>
  <FONT COLOR="#FFFF00" SIZE=+1
  >誘われると、断ることが不可能</FONT>
</P>
なだけです、はい。でも、だからといって
<P ALIGN=CENTER>
  <FONT COLOR="#FF00FF" SIZE=+1
  >E-Mail で酒に誘わないように</FONT>
<BR>(よく考えたら、両方とも E-Mailだなぁ)
</P>
というわけで、２日連続でかなり飲んだため、
土曜日も今一体調がよくないっす。
NYAOS も下手に触るとバグを増すだけなんで、
とりあえず、前からやってる、かんなのドライブ対策と、
ドキュメントのHTML化しかやっとりません。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
窓キーって邪魔ですねぇ。
ALTキーやCTRLキーが押しにくくて仕方が無い。
会社では Windows95 しか使っていないんですけど、
キーボードが 109キー という奴なんですよ。
<P>
最初、窓キーを見た時、
<P ALIGN=CENTER>
  <FONT COLOR=#FFFF00 SIZE=+1>
	おお、Microsoft もメタキー/コマンドキーを新たに用意するとは<BR>
	<BIG>なかなかやるな</BIG>
  </FONT>
</P>
そうショートカットキーを増せるし、逆にこれで Ctrl キーを
他の用途に解放できるじゃないかと思ったんです。あさはかでしたね。
<P ALIGN=CENTER>
   <FONT COLOR="#FF00FF" SIZE=+1>単にStartボタンを押すだけのキーとは…<BR>
	<BIG>俺が悪かった</BIG>
   </FONT>
</P>
まぁ、窓キーは誰でも思うところなんでしょうけども、他にも結構、
キーボードにはこだわりがあったりしてまして、
長い間次を見たしたキーボードを探してます。
<DL>
<DT>・CtrlキーはShiftキーの<B>下</B>、キーボードの最も左下に欲しい。
<DD>	これは意外かもしれませんが、僕は Ctrl キーを小指の根本の<!--
	-->ところでタイプするんです。これだと手首を少し左へ傾けるだけで<!--
	-->打てるので、小指に対する負担が少なくて済み、長時間のタイプ<!--
	-->にも耐えらます。また Ctrl-A の時でも「Ａ」自身を小指で打てます。
	でも、やっぱり、僕は少数派なんでしょうねぇ。

<DT>・テンキー、カーソルキーの無くて、サイズが小さい
<DD>	やっぱ、でっかいキーボードは邪魔です。

<DT>・変換キーは要らない。
<DD>	かんな、SKKを使っている分には全く要りません。

<DT>・記号配列は JIS配列でよい。
<DD>	これは純粋に慣れのせいもありますけど、よそへ行った時は、
	ほとんど 106 or 109 なんで、なるべく同じ配列の方が助かります。
</DL>
まぁ、一番最後の JIS配列はどうでもいいんですけど、
テンキー無しで、Ctrlキーが最も左下にあるキーボードは未だ見付かりません。
Happy Hacking Keyboard で、Ctrl は Shift の上下にあったら最高なんですけどね。
というわけで、僕は5年前から使っている、
テンキー、すなわちデカサ以外は全て満たしているキーボードを未だ手放せません。
あ〜あ。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
最近、僕は OS/2 に関してやや悲観的な見方しかしていなかったのですけど、
ここんとこ、思ったよりもポコポコ、フリーソフトが出ていますね。
ありがたいこってす。
これで OS/2 本体が安かったら...３万円代では、ちょっと普通の人は
ためらうでしょう。昔、Win3.1 のころの DOS からの upgrade で
1万円代で買えたことを思うと...本当に Freeにならないかな OS/2。
「FreeOS2」なんてね。
<P>
<A HREF="http://www.netpassport.or.jp/~wdaida/vzf/vzf.html">VZF</A>なる
ファイラーが現れたとの報を受け(って、宇野さんのページ拝見しただけだけど)、
さっそく試してみました。ふむ、これは確かに Vz ライクだ。なかなかよろし。
ただ、やっぱりCtrl+? でカーソルが移動できない。これはＰＭプログラムだったら
仕方ないのかしら。FWE とかは、もしかして、かなりアクロバットなことして<!--
-->るんでしょうかねぇ。NyaosPMへの道は遠し!?。
<P>
宇野さん、<A HREF="http://www.jks.is.tsukuba.ac.jp/~uno/diary/index.html"
>応援</A>ありがとうございます。しかし、どうも、ここんところ、
うちに帰るのが遅くて、なかなか OS/2 と戯れることができません。
この休みも先程書いたようにアルコールの後遺症で×だし
(しかし Web はしっかり書いている)。
ちょっと、ファイラー作るとか、エディター作るとか、一行NYAOS作るとか、
大言壮語しすぎちゃったかなぁ。ああ、一ヶ月ほど、休みが欲しいわ。
連休よ、早く来てくれぇー！

<HR>

<H3><A NAME="title"
    ><FONT COLOR="#00FFFF"><I>ウインドウのタイトル</I></FONT></A>(7/5)</H3>

どうも、先週は InterQ さんが悪いのか、手元の Warp が悪いのか、
このページの upload がうまくできませんでした。
なぜか「...bytes 転送しました」の後に凍るんです。
で、http://hp.vector.co.jp/authors/VA009797/ 以下も
モジラでうまく見れなかったし、
てっきり、先週は更新できなかったんだなぁと思ってたら....<BR>
....ちゃんと、HTMLファイル転送できていたみたいですねぇ。
まぁ、いいか。1.41 も公開できてなかったと思っていたんですけどねぇ。
段取り狂っちゃった。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
某Ｕ氏より(ばればれ？)、WinSetTitle という隠しAPIの存在を教えて
いただきました。これを使えば、以前よりの課題であった
「CMD.EXE みたいに、ウインドウのタイトルに現在実行しているプログラムの
名前を設定する」を実現できるのでは？というわけです。
<P>
いろいろと苦労しつつも、何とかインポートライブラリを作って呼び出すことに成功
しました。しかし、「start nyaos.exe」と実行した時しか、ウインドウタイトルが
変わりません。どうやら『タイトル文字列が未設定で代わりに「NYAOS.EXE」という
タイトルが表示されるような場合』に限って、
タイトルを変更できるというもののようです。う〜む、残念。
でも、CMD.EXE だって、プログラムオブジェクトで実行ファイル名を「*」で
はなく「CMD.EXE」にすると同様の挙動になるんだし、
それに、16bit API のemxからの呼び方が分かったからよしとしよう。
というわけで、せっかくだから、
<PRE>
        APIRET16 APIENTRY16 WinSetTitle ( PSZ szTitle ) ;
</PRE>
のemx よりの呼び出し方を以下に示します。
詳しくは emx のマニュアル見てください(日本語版もあったはず)。
<PRE>
<I>呼び出しルーチン：</I>
	extern "C" { /* extern は C++ の為、C なら次の行だけでよい */
	  void _THUNK_C_FUNCTION (WinSetTitle) (PSZ szTITLE);
	}
	void set_win_title( const char *title )
	{
	  _THUNK_C_PROLOG ( 4 );	 /* 全引数のバイト数 */
	  _THUNK_C_FLAT ( title );	 /* 32bitポインタの第一引数 */
	  _THUNK_C_CALL ( WinSetTitle ); /* さぁて、コール */
	}
<I>Makefile：</I>
	wstitle93.a : wstitle.imp
		emximp -o wstitle93.a wstitle.imp
<I>wstitle.imp:</I>
	_WinSetTitle pmshapi 93 F
</PRE>
さて、他のバグとしては、かんなのインストールされているドライブ以外から
NYAOSを起動すると、/usr/local/canna/lib/default.canna が認識されない
というのがあります。一つの対策として、コンパイルオプションに -Zmtd
を加えるというのがあります。これ、マルチスレッド化するオプションなん
ですけど、そもそも、なぜ、そんなことをして直るのかが謎っす。
とりあえず、今、初期化の際に/usr/local/canna/lib がありそうなドライブに
一時的に移動するという方向で fix しています。
この修正版は多分来週くらいに公開します。(週刊NYAOS敗れたり？)
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
某所より
<P ALIGN=CENTER>
	<FONT COLOR="#FFFF00" SIZE=+1>ＰＭ版一行 NYAOS 作っとくれー</FONT>
<P>
という要請が届いています。とりあえず、今、Charles Petzold著「プログラミング
ＯＳ／２ＰＭ」を買って読んでいます。でも、もし、どうしてもできそうも
なかったら、ＰＭ部分だけ、人に頼もうかと思ってます。さて、誰に頼むか...
<P ALIGN=CENTER>
 <FONT COLOR="#FF00FF" SIZE=+1>それは貴方かもしれない...(不動 明調で)</FONT>
</P>
まぁ、今は現在のテキストベースNYAOSのメンテ他の課題が山積みになってますから、
当分後になることでしょうが、油断しないように(何を)
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
この週末は結構ハードスケジュールでした。
金曜16:00ごろ、大学の友達よりメイル。「今晩、18:00 より、プロセス設計
(化学工学教室内の発表)の打ち上げがあるけど、来れへんよね」
<P ALIGN=CENTER>
	<FONT SIZE=+1 COLOR="#FFFF00">当然、いきます</FONT>
</P>
というわけで、大阪江坂から 17:30 定時に会社を脱出。そのまま、京都まで
急行してしまいました。ははは。しかし、卒業して３ヶ月くらいなのに、
すでに研究室の飲み会には２回も参加している。
<P ALIGN=CENTER>
	<FONT SIZE=+1 COLOR="#FF00FF">
	もう、窓際になったのかと心配されてしまった。
	</FONT>
</P>
で、翌日の土曜は、吹田の体育館で、会社の友達とバトミントンを楽しみました。
<P ALIGN=CENTER>
	<FONT SIZE=+1 COLOR="#FF00FF">
	前の晩、あれだけ飲めば、普通、二日酔いで動けないはずなのだが…
	</FONT>
</P>
今、筋肉痛で死んでます。
<P ALIGN=CENTER>
	<FONT COLOR="#EEEEAA">≡★</FONT>
</P>
では、魂の叫びを連発します(ゴッドハンド現れるかな)。
<DL>
<DT><BIG>wget</BIG>
<DD>	うーむ、--time-stamp オプションを入れてあるから、前回、download した
	ファイルは無視するはずなのにぃ...なんか、更新されていないページまで
	再download されてそう。何がいけないんだろう。
	ドラえもーん、たすけてぇー。
<DT><BIG>ベルセルク</BIG>
<DD>	単行本。どこにも無いよぉーん。ＴＶも今週はシティーハンターになって
	しまってるし。うーむ、あの続きが気になって仕方ないっす。
<DT><BIG>某Ｒ氏</BIG>
<DD>	会社で Warp が触れるって？ なんて、うらやましいんだぁぁぁ。
	転職しようか(おいおい)。
<DT><BIG>山地氏</BIG>(なぜ、匿名でないんでしょうね)
<DD>	毎週、更新しているからって、暇ぢゃないぞ！
</DL>

<HR>
<FONT COLOR="#EEEEAA" SIZE=-1>▼</FONT
><a href="0.html">さらに過去の葉山文書へ</a>
<FONT COLOR="#EEEEAA" SIZE=-1>▼</FONT
><a href="./index.html">目次へ</a>
</BODY>
</HTML>
